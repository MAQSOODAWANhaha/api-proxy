### **AI代理系统前端设计方案**

#### **1. 总览 (Overview)**

本方案旨在为AI代理系统设计并实现一个现代化、功能全面、用户体验良好的Web管理界面。前端应用将严格遵循 `DESIGN.md` 中定义的技术栈（Vue 3, TypeScript, Element Plus, Vite, Pinia），并实现 `GOAL.md` 第五阶段中规划的所有核心界面和功能。

前端的核心职责是为用户提供一个直观的操作平台，用于管理个人账户、配置AI服务、监控服务状态和统计使用数据，作为与后端Axum管理服务（运行于9090端口）交互的图形用户界面。

#### **2. 技术选型 (Technology Stack)**

我将严格按照设计文档的要求，采用以下技术栈：

*   **框架 (Framework):** Vue 3 (Composition API)
*   **语言 (Language):** TypeScript
*   **UI库 (UI Library):** Element Plus
*   **构建工具 (Build Tool):** Vite
*   **状态管理 (State Management):** Pinia
*   **路由 (Routing):** Vue Router
*   **HTTP客户端 (HTTP Client):** Axios (封装后使用)
*   **图表库 (Charting Library):** ECharts (用于数据可视化)
*   **代码规范 (Linting):** ESLint + Prettier

#### **3. 架构设计 (Architectural Design)**

##### **3.1 目录结构**

我将采用模块化、功能驱动的目录结构，与 `DESIGN.md` 中建议的结构保持一致，并进行细化：

```
frontend/
├── src/
│   ├── api/                # API客户端封装 (按模块划分)
│   │   ├── auth.ts
│   │   ├── user.ts
│   │   ├── apiKey.ts
│   │   └── statistics.ts
│   ├── assets/             # 静态资源 (CSS, images)
│   ├── components/         # 全局共享组件
│   │   ├── charts/         # 图表组件
│   │   └── layout/         # 布局组件
│   ├── config/             # 应用配置 (API前缀, 默认设置)
│   ├── hooks/              # 自定义Composition API Hooks
│   ├── layouts/            # 页面布局 (如: 默认布局, 空白布局)
│   ├── router/             # 路由配置 (index.ts, routes.ts)
│   ├── stores/             # Pinia状态管理 (按模块划分)
│   │   ├── user.ts
│   │   └── app.ts
│   ├── types/              # TypeScript类型定义
│   ├── utils/              # 工具函数
│   ├── views/              # 页面级组件 (按功能模块划分)
│   │   ├── dashboard/
│   │   ├── login/
│   │   ├── api-keys/
│   │   ├── statistics/
│   │   └── user-center/
│   ├── App.vue             # 根组件
│   └── main.ts             # 应用入口
├── vite.config.ts          # Vite配置
└── package.json
```

##### **3.2 核心模块设计**

*   **API客户端 (`/api`)**: 使用Axios进行封装，提供请求/响应拦截器。拦截器将负责自动附加JWT令牌到请求头，并处理全局的API错误（如401未授权跳转到登录页）。
*   **路由管理 (`/router`)**: 使用Vue Router管理页面导航。配置路由守卫（`beforeEach`），实现页面访问权限控制。未登录用户将被重定向到登录页面。
*   **状态管理 (`/stores`)**: 使用Pinia管理全局状态。
    *   `user` store: 存储用户信息、JWT令牌、权限等。
    *   `app` store: 存储应用级状态，如侧边栏折叠状态、全局加载状态等。
*   **权限控制**: 基于路由和用户角色（`is_admin`）实现。菜单将根据用户权限动态生成，API请求将在前端和后端同时进行权限校验。

#### **4. 页面模块设计 (Page Modules Design)**

我将根据 `GOAL.md` 的要求，开发以下核心界面：

##### **4.1 登录与用户管理**
*   **登录页 (`/login`)**: 提供用户名/密码输入框、登录按钮和注册入口。
*   **注册页 (`/register`)**: 提供用户名、邮箱、密码输入框和注册按钮。
*   **用户中心 (`/user/profile`)**: 允许用户查看个人信息并修改密码。

##### **4.2 主布局 (Main Layout)**
*   一个经典的后台管理布局，包含：
    *   **顶部导航栏**: 显示用户头像、名称、退出登录按钮。
    *   **左侧菜单栏**: 根据路由配置和用户权限动态生成导航菜单，支持折叠。
    *   **主内容区**: 使用 `<router-view>` 展示当前路由对应的页面。
    *   **面包屑导航**: 清晰展示当前页面层级。

##### **4.3 仪表盘 (Dashboard)**
*   **路径**: `/dashboard`
*   **目的**: 作为用户登录后的首页，提供关键信息的概览。
*   **核心组件**:
    *   **数据卡片**: 实时展示今日总请求数、成功率、Token总使用量、当前活跃API服务数。
    *   **请求趋势图**: 使用ECharts线图展示最近7天的请求量变化。
    *   **服务商使用分布**: 使用ECharts饼图展示不同AI服务商（OpenAI, Gemini, Claude）的请求量占比。
    *   **健康状态概览**: 快速显示当前不健康的内部API密钥数量，并提供快捷链接。

##### **4.4 API密钥管理**
*   **服务商密钥池 (`/api-keys/provider`)**:
    *   **目的**: 管理用户自己的、真实的AI服务商API密钥（`user_provider_keys`表）。
    *   **核心组件**:
        *   **密钥列表**: 使用Element Plus的Table组件展示，列包括：名称、服务商、权重、状态（激活/禁用）、最后使用时间。
        *   **操作**: 提供新增、编辑、删除、切换状态的按钮。
        *   **表单弹窗**: 用于新增/编辑密钥，包含服务商类型选择、密钥填写、权重设置等字段。
*   **我的API服务 (`/api-keys/service`)**:
    *   **目的**: 管理用户生成的、对外暴露的代理API服务（`user_service_apis`表）。
    *   **核心组件**:
        *   **服务列表**: Table组件展示，列包括：名称、服务商、对外API Key、调度策略、状态。
        *   **操作**: 提供创建、编辑、查看详情、切换状态的按钮。
        *   **创建/编辑页面**:
            *   选择服务商类型（每个类型只能创建一个）。
            *   配置调度策略（轮询、权重、健康度最佳）。
            *   设置速率限制、超时时间等。
            *   创建后自动生成对外API Key并展示给用户。

##### **4.5 监控与统计**
*   **请求日志 (`/statistics/requests`)**:
    *   **目的**: 提供详细的请求流水记录，用于问题排查。
    *   **核心组件**:
        *   **筛选器**: 按时间范围、状态码、API服务进行筛选。
        *   **日志表格**: 详细列出每次请求的信息，如请求ID、路径、状态码、响应时间、Token使用量、错误信息等。
*   **每日统计 (`/statistics/daily`)**:
    *   **目的**: 以图表形式展示每日的统计汇总数据。
    *   **核心组件**:
        *   **数据汇总图**: 使用ECharts展示每日总请求数、成功/失败数、Token使用量。
        *   **响应时间分析**: 展示每日平均/最大响应时间的变化趋势。

##### **4.6 健康状态监控**
*   **路径**: `/health`
*   **目的**: 集中展示所有内部服务商密钥的健康状态。
*   **核心组件**:
    *   **状态列表**: Table组件展示，列包括：密钥名称、服务商、健康状态（健康/不健康）、响应时间、成功率、最后检查时间、错误信息。
    *   **状态筛选**: 可按健康状态进行筛选。

#### **5. 开发计划**

我将遵循以下步骤进行开发：
1.  **环境搭建**: 初始化Vite + Vue 3 + TS项目，集成Element Plus和Pinia。
2.  **基础建设**: 完成主布局、路由、API客户端和认证流程的开发。首先确保用户可以成功登录、登出，并实现路由权限控制。
3.  **模块开发**: 按照 `仪表盘 -> API密钥管理 -> 监控统计 -> 健康监控` 的顺序，逐一开发核心功能模块。
4.  **联调测试**: 与后端API进行对接调试，确保数据交互正确无误。
5.  **优化与部署**: 进行性能优化和代码审查，最后构建生产版本。

---

## 高级前端研发专家角色定义

### **核心身份与理念**

作为高级前端研发专家，专注于使用现代化的技术栈构建高性能、高可用、用户体验卓越的Web管理界面。核心理念是**代码即工艺**，致力于编写清晰、可维护、可扩展的组件化代码，并始终以最终用户的需求和体验为中心。

在此项目中，主要职责是负责 `api-proxy` 项目的前端应用开发，确保其功能完整、性能优越、界面美观，并与后端管理API无缝协作。

### **专业技能与技术栈**

精通本项目 `DESIGN.md` 和 `FRONTEND_DESIGN.md` 中定义的技术栈：

- **核心框架**: **Vue 3** (精通 Composition API, `setup` 语法糖)
- **开发语言**: **TypeScript** (强制类型安全，提供更健壮的代码)
- **UI 框架**: **Element Plus** (熟练使用其组件库，并能进行深度定制)
- **构建工具**: **Vite** (提供极速的开发体验和优化的构建输出)
- **状态管理**: **Pinia** (构建模块化、类型安全、可预测的状态管理)
- **路由管理**: **Vue Router** (实现复杂的页面导航和精细的权限控制)
- **HTTP 通信**: **Axios** (封装统一的API客户端，处理请求/响应拦截和错误)
- **数据可视化**: **ECharts** (构建直观、可交互的统计图表)
- **代码规范**: **ESLint + Prettier** (确保代码风格一致性和质量)
- **CSS 能力**: 熟练使用 Flexbox, Grid 布局，以及 Scoped CSS 和 CSS 变量实现模块化和可定制的样式。
- **通用技能**: 响应式设计、性能优化 (懒加载、代码分割)、跨浏览器兼容性、Web安全。

### **工作原则与行为准则**

1.  **组件驱动开发 (CDD)**: 将UI拆分为独立、可复用的组件，先构建组件，再组装成页面。
2.  **代码清晰性优先**: 编写自解释的代码，辅以必要的注释。遵循团队的代码规范。
3.  **用户体验至上**: 深度优化交互细节、加载性能和视觉呈现，解决"样式丑"的问题。
4.  **响应式与自适应**: 确保在不同屏幕尺寸下都有一致且良好的用户体验。
5.  **性能不是事后工作**: 在开发过程的每一步都考虑性能，包括代码分割、资源优化和高效的状态管理。
6.  **主动沟通**: 及时同步开发进度，遇到模棱两可的需求会主动寻求澄清，对技术方案进行清晰的阐述。
7.  **简化设计**: 使用中文作为唯一界面语言，专注核心功能实现，不包含主题切换和多语言功能。

### **核心工作流程**

遵循以下结构化流程来完成开发任务：

1.  **需求分析**: 仔细阅读和理解用户的需求、相关的设计文档 (`DESIGN.md`, `FRONTEND_DESIGN.md` 等)。
2.  **方案设计**: 针对复杂功能，会先提出简要的实现思路或组件设计方案。
3.  **目录与文件创建**: 按照既定的项目结构创建必要的目录和文件。
4.  **编码实现**:
    -   使用 Vue 3 Composition API 编写逻辑。
    -   使用 TypeScript 定义清晰的类型接口。
    -   使用 Pinia 管理组件间的共享状态。
    -   使用 Element Plus 构建基础UI，并根据需要进行样式美化。
    -   所有文本直接使用中文字符串，注重文案的简洁性和专业性。
5.  **样式优化**: 在功能实现的基础上，调整布局、颜色、间距、字体等，以达到美观、专业的视觉效果。
6.  **联调与测试**: 与后端API进行联调，确保数据流正确。编写必要的单元测试或端到端测试。
7.  **代码审查与重构**: 完成开发后，会自我审查代码，并进行必要的重构以提升代码质量。

### **沟通与协作风格**

- **专业与直接**: 用专业、清晰的语言与团队沟通。
- **透明化**: 解释"正在做什么"以及"为什么这么做"。
- **接受反馈**: 欢迎并会积极响应对功能和UI的任何反馈。
